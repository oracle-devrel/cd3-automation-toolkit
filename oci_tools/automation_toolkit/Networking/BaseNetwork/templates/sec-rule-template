            {% if rule_type.lower() == 'ingress' %}
            ingress_security_rules {
                #Required
                protocol = "{{ protocol_code }}"
                source = "{{ source }}"

                #Optional
                {% if rule_description != '' %}
                description = "{{ rule_description }}"
                {% endif %}
                stateless = {{ isstateless }}

                {% if protocol.lower() == 'icmp' and icmptype != '' %}
                icmp_options {
                    #Required
                    type = "{{ icmptype }}"
                    {% if icmpcode != '' %}
                    #Optional
                    code = {{ icmpcode }}
                    {% endif %}
                }
                {% endif %}

                {% if source_type and source_type != '' %}
                source_type = "{{ source_type }}"
                {% endif %}

                {% if protocol.lower() == 'tcp' or protocol.lower() == 'udp' %}
                {% if (dportmax and dportmin) or (sportmax and sportmin) %}

                {{ protocol.lower() }}_options {
                    {% if dportmax and dportmin %}
                    #Optional
                    max = "{{ dportmax }}"
                    min = "{{ dportmin }}"
                    {% endif %}
                    {% if sportmax and sportmin %}
                    source_port_range {
                        #Required
                        max = "{{ sportmax }}"
                        min = "{{ sportmin }}"
                    }
                    {% endif %}
                }
                {% endif %}
                {% endif %}
            }
            {% endif %}

            {% if rule_type.lower() == 'egress' %}
            egress_security_rules {
                #Required
                protocol = "{{ protocol_code }}"
                destination = "{{ destination }}"

                #Optional
                {% if rule_description != '' %}
                description = "{{ rule_description }}"
                {% endif %}
                stateless = {{ isstateless }}

                {% if protocol.lower() == 'icmp' and icmptype != '' %}
                icmp_options {
                    #Required
                    type = "{{ icmptype }}"
                    {% if icmpcode != '' %}
                    #Optional
                    code = {{ icmpcode }}
                    {% endif %}
                }
                {% endif %}

                {% if destination_type and destination_type != '' %}
                destination_type = "{{ destination_type }}"
                {% endif %}

                {% if protocol.lower() == 'tcp' or protocol.lower() == 'udp' %}
                {% if (dportmax and dportmin) or (sportmax and sportmin) %}

                {{ protocol.lower() }}_options {
                    {% if dportmax and dportmin %}
                    #Optional
                    max = "{{ dportmax }}"
                    min = "{{ dportmin }}"
                    {% endif %}
                    {% if sportmax and sportmin %}
                    source_port_range {
                        #Required
                        max = "{{ sportmax }}"
                        min = "{{ sportmin }}"
                    }
                    {% endif %}

                }
                {% endif %}
                {% endif %}
            }
            {% endif %}