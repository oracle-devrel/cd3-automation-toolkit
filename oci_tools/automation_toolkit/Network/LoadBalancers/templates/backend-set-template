#Backend Set
resource "oci_load_balancer_backend_set" "{{ lbr_tf_name }}_{{ backend_set_tf_name }}" {
    #Required
    health_checker {
        #Required
        protocol = "{{ backend_healthcheck_protocol }}"

        #Optional
        {% if port != '' %}
        port = "{{ backend_healthcheck_port }}"
        {% endif %}
        {% if backend_healthcheck_protocol == 'HTTP' %}
        url_path = "{{ backend_healthcheck_url }}"
        {% endif %}
        {% if interval_in_millis and interval_in_millis != '' and interval_in_millis != 'nan' %}
        interval_ms = "{{ interval_in_millis }}"
        {% endif %}
    }
    load_balancer_id = oci_load_balancer_load_balancer.{{ lbr_tf_name }}.id
    name = "{{ backend_set_name }}"
    policy = "{{ backend_policy }}"

    #Optional
    {% if session == "LB" %}
    lb_cookie_session_persistence_configuration {

        #Optional
        cookie_name = "{{ cookie_name }}"
        disable_fallback = {{ disable_fallback }}
        path = "{{ cookie_path }}"
    }
    {% else %} {% if session == "Backend Server" %}
    session_persistence_configuration {
        #Required
        cookie_name = "{{ cookie_name }}"

        #Optional
        disable_fallback = {{ disable_fallback }}

    }
    {% endif %} {% endif %}
    {% if usessl == 'y' %}
    ssl_configuration {
        #Required
        certificate_name = oci_load_balancer_certificate.{{ lbr_tf_name }}_{{ certificate_tf_name }}.certificate_name

        #Optional
        {% if verify_peer_certificate %}
        verify_peer_certificate = {{  verify_peer_certificate }}
        verify_depth = {{ verify_depth }}
        {% endif %}
        {% if cipher_suite_name %}
        protocols = [ {{ ssl_protocols }} ]
        cipher_suite_name = "{{ cipher_suite_name }}"
        {% endif %}

    }{% endif %}
}
